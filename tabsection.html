<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <title>Ticket Management</title>
    <style>
      body {
        font-family: "Roboto", sans-serif;
        margin: 0;
        background-color: #fafbff;
      }
      .hidden {
        display: none;
      }
      .fixed-bottom {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: #ffffff;
      }
      .container {
        margin: 0 auto;
        background-color: #eeeff4;
        padding: 2px;
      }
      .tab {
        text-align: center;
        cursor: pointer;
        color: rgb(31, 87, 209);
        padding: 15px;
      }
      .active-tab {
        border-bottom: 2px solid rgb(31, 87, 209);
        font-weight: bold;
      }
      .button {
        padding: 10px 15px;
        background-color: rgb(31, 87, 209);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      .button:hover {
        background-color: #2741b6;
      }
      .card {

        margin-top: 10px;
  
      }
    

.shimmer {
  background-color: #ccc;

  animation: shimmer 1.5s infinite;
}
    </style>
  </head>
  <body>
    <div id="loading" class="   rounded-md">
     
      <div
        class="my-2 rounded-lg mx-2"
        style="
          width: 200px;
          height: 40px;
          background-color: #ecebeb;
        "
      ></div>
      <div
        class="my-2 rounded-lg mx-2"
        style="
          width: 300px;
          height: 40px;
          background-color: #ecebeb;
        "
      >
    </div>
    <div class="flex ">
      <div
      class="my-2 rounded-lg mx-2"
      style="
        width: 200px;
        height: 40px;
        background-color: #ecebeb;
      "
    ></div><div
    class="my-2 rounded-lg mx-2"
    style="
      width: 200px;
      height: 40px;
      background-color: #ecebeb;
    "
  ></div>
    </div>
    <div
        class="my-4 rounded-lg mx-2"
        style="
          
          padding: 3px;
          background-color:  #ecebeb;
        "
      >
      <div class="flex">   <div
        class="my-2 rounded-lg mx-2"
        style="
          width: 200px;
          height: 20px;
       
          background-color:  #e2e2e2;
        "
      ></div>   <div
      class="my-2 rounded-lg mx-2"
      style="
        width: 200px;
        height: 20px;
     
        background-color:  #e2e2e2;
      "
    ></div></div>
    <div
    class="my-2 rounded-lg mx-2"
    style="
      width: 200px;
      height: 20px;
   
      background-color:  #e2e2e2;
    "
  ></div>
  <div
  class="my-2 rounded-lg mx-2"
  style="
    width: 200px;
    height: 20px;
 
    background-color:  #e2e2e2;
  "
></div>
<div
class="my-2 rounded-lg mx-2"
style="
  
  height: 40px;

  background-color:  #e2e2e2;
"
></div>
    
   
    </div>
    <div
    class="my-4 rounded-lg mx-2"
    style="
      
      padding: 3px;
      background-color:  #ecebeb;
    "
  >
  <div class="flex">   <div
    class="my-2 rounded-lg mx-2"
    style="
      width: 200px;
      height: 20px;
   
      background-color:  #e2e2e2;
    "
  ></div>   <div
  class="my-2 rounded-lg mx-2"
  style="
    width: 200px;
    height: 20px;
 
    background-color:  #e2e2e2;
  "
></div></div>
<div
class="my-2 rounded-lg mx-2"
style="
  width: 200px;
  height: 20px;

  background-color:  #e2e2e2;
"
></div>
<div
class="my-2 rounded-lg mx-2"
style="
width: 200px;
height: 20px;

background-color:  #e2e2e2;
"
></div>
<div
class="my-2 rounded-lg mx-2"
style="

height: 40px;

background-color:  #e2e2e2;
"
></div>


</div>
<div
class="my-4 rounded-lg mx-2"
style="
  
  padding: 3px;
  background-color:  #ecebeb;
"
>
<div class="flex">   <div
class="my-2 rounded-lg mx-2"
style="
  width: 200px;
  height: 20px;

  background-color:  #e2e2e2;
"
></div>   <div
class="my-2 rounded-lg mx-2"
style="
width: 200px;
height: 20px;

background-color:  #e2e2e2;
"
></div></div>
<div
class="my-2 rounded-lg mx-2"
style="
width: 200px;
height: 20px;

background-color:  #e2e2e2;
"
></div>
<div
class="my-2 rounded-lg mx-2"
style="
width: 200px;
height: 20px;

background-color:  #e2e2e2;
"
></div>
<div
class="my-2 rounded-lg mx-2"
style="

height: 40px;

background-color:  #e2e2e2;
"
></div>


</div>
<div
class="my-4 rounded-lg mx-2"
style="
  
  padding: 3px;
  background-color:  #ecebeb;
"
>
<div class="flex">   <div
class="my-2 rounded-lg mx-2"
style="
  width: 200px;
  height: 20px;

  background-color:  #e2e2e2;
"
></div>   <div
class="my-2 rounded-lg mx-2"
style="
width: 200px;
height: 20px;

background-color:  #e2e2e2;
"
></div></div>
<div
class="my-2 rounded-lg mx-2"
style="
width: 200px;
height: 20px;

background-color:  #e2e2e2;
"
></div>
<div
class="my-2 rounded-lg mx-2"
style="
width: 200px;
height: 20px;

background-color:  #e2e2e2;
"
></div>
<div
class="my-2 rounded-lg mx-2"
style="

height: 40px;

background-color:  #e2e2e2;
"
></div>


</div>
    </div>
    <div id="app" class="roboto-thin hidden">
      <div id="content" class="">
        <div class="container">
          <div class="flex justify-between">
            <div class="p-3">
              Hi <span id="username"></span>,<br />We are here to help you
            </div>
            <div id="create-ticket-button" >
                <div class=" md:block hidden">
                <button type="button" class="button" onclick="openCreate()">
                  Create Ticket
                </button>
            </div>
              </div>
          </div>

          <div class="grid grid-cols-12 px-2">
            <div
              id="open-tickets-tab"
              class="col-span-6 tab cursor-pointer text-center text-blue-400 p-4"
              onclick="getTabId(1)"
            >
              Open Tickets (<span id="open-tickets-count">0</span>)
            </div>
            <div
              id="resolved-tickets-tab"
              class="col-span-6 tab cursor-pointer text-center text-blue-400 p-4"
              onclick="getTabId(2)"
            >
              Resolved Tickets (<span id="resolved-tickets-count">0</span>)
            </div>
          </div>
        </div>
       
        <div class="card ">
         
          <div id="ticket-content" class="w-full h-screen hidden">
            <div id="open" class="container mx-auto p-4">
              <div id="ticket-container" class="md:flex md:gap-8">
                <div class="w-full md:w-[90%]">
                  <div id="ticket-list" class="py-2 px-2 min-h-screen">
                    <!-- Tickets will be dynamically generated here -->
                  </div>
                </div>

                <div class="md:block hidden w-[40%]">
                  <div
                    class="bg-white border-gray rounded-md p-6 shadow-md h-fit w-full"
                  >
                    <div class="text-lg font-sans my-1">FAQ</div>
                    <div class="flex justify-between">
                      <div class="text-sm font-sans my-0.5">
                        Account Details
                      </div>
                      <div class="mx-1 mt-1">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 24 24"
                          fill="gray"
                          class="w-4 h-4"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                    </div>
                    <div class="flex justify-between">
                      <div class="text-sm font-sans my-0.5">
                        Brokage and Other Charges
                      </div>
                      <div class="mx-1 mt-1">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 24 24"
                          fill="gray"
                          class="w-4 h-4"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                    </div>
                    <div class="flex justify-between">
                      <div class="text-sm font-sans my-0.5">
                        Funds & Account Balance
                      </div>
                      <div class="mx-1 my-1">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 24 24"
                          fill="gray"
                          class="w-4 h-4"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                    </div>
                    <div class="flex justify-between">
                      <div class="text-sm font-sans my-0.5">
                        IPO & OFS and Mutual Fund
                      </div>
                      <div class="mx-1 mt-1">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 24 24"
                          fill="gray"
                          class="w-4 h-4"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                    </div>
                  </div>
                  <div
                    class="justify-end flex items-center text-sm text-[#0d6efd] font-semibold py-3"
                  >
                    <div>SEE MORE</div>
                    <div class="mx-1">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        fill="#0d6efd"
                        class="w-4 h-4"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z"
                          clip-rule="evenodd"
                        />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>

              <div
                id="no-tickets"
                class="flex justify-center items-center hidden"
              >
                <div>
                  <img src="images/no-data-found.jpeg" alt="" class="p-20">
                  <p class="text-center py-3 text-gray-600 min-h-screen">

                    No tickets available
                  </p>
                </div>
              </div>

              <div
                id="ticket-modal"
                class="fixed inset-0 z-50 hidden overflow-hidden flex justify-center items-center min-h-screen"
                style="background: rgba(113, 110, 110, 0.7)"
              >
                <div
                  class="border shadow-lg modal-container bg-white w-full h-full shadow-lg z-50 overflow-y-auto"
                >
                  <div class="modal-content text-left h-full">
                    <div class="bg-[#eeeff4] md:bg-white md:py-5 md:mt-[5%]">
                      <div
                        class="flex justify-between w-full items-center container md:w-[90%] mx-auto"
                      >
                        <div class="p-3 md:py-6 md:text-[30px]">
                          Hi <span id="username"></span>,<br />
                          We are here to help you
                        </div>
                        <div class="md:block hidden md:pl-6">
                          <button
                            id="create-ticket"
                            class="block py-2 px-3 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-lg bg-blue-600 text-white hover:bg-[#2741b6] disabled:opacity-50 disabled:pointer-events-none"
                          >
                            Create Ticket
                          </button>
                        </div>
                      </div>
                    </div>
                    <div
                      class="flex flex-col md:bg-white pointer-events-auto max-w-full max-h-full h-full"
                    >
                      <div class=" container md:mx-auto md:w-[90%]">
                        <div
                          class="flex justify-between items-center py-3 px-2"
                        >
                          <div class="flex items-center">
                            <div id="back-button" class="cursor-pointer" onclick="closeTicketModal()">
                              <svg
                                xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 20 20"
                                fill="currentColor"
                                class="w-7 h-7"
                              >
                                <path
                                  fill-rule="evenodd"
                                  d="M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z"
                                  clip-rule="evenodd"
                                />
                              </svg>
                            </div>
                            <div
                              class="text-sm font-semibold"
                              id="ticket-number"
                            >
                              #12345
                            </div>
                          </div>
                          <div class="md:px-6">
                            <div
                              class="uppercase bg-yellow-200 text-xs px-4 py-2 flex items-center justify-center"
                              id="ticket-status"
                            >
                              Open
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="pb-20 md:pb-5 bg-[#eeeff4] ">
                        <div class="w-full p-4 md:bg-white">
                          <div id="ticket-details" class="flex flex-col">
                            <!-- Ticket details will be dynamically generated here -->
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div
                id="status-modal"
                class="fixed inset-0 z-50 hidden overflow-hidden flex justify-center items-center"
                style="background: rgba(0, 0, 0, 0.7)"
              >
                <div
                  class="border shadow-lg modal-container bg-white w-11/12 mx-auto rounded-xl shadow-lg z-50 overflow-y-auto"
                >
                  <div class="modal-content py-4 text-left px-6 h-full">
                    <div id="status-message" class="flex justify-center py-3">
                      Status message here
                    </div>
                    <div
                      class="flex justify-center items-center gap-x-2 py-3 px-4"
                    >
                      <button
                        type="button"
                        class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none"
                        id="go-back-button"
                      >
                        Go Back
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div
                id="image-modal"
                class="fixed inset-0 z-50 hidden overflow-auto flex justify-end items-center"
                style="background: rgba(0, 0, 0, 0.7)"
              >
                <div
                  class="border shadow-lg modal-container bg-white w-11/12 mx-auto rounded-xl shadow-lg z-50 overflow-y-auto"
                >
                  <div
                    class="flex justify-end items-center p-2 pointer"
                    id="close-image-modal"
                  >
                    <button
                      type="button"
                      class="flex justify-center items-center size-7 text-sm font-semibold rounded-full text-gray-800 hover:bg-gray-100 disabled:opacity-50 disabled:pointer-events-none"
                    >
                      <span class="sr-only">Close</span>
                      <svg
                        class="flex-shrink-0 size-4"
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path d="M18 6 6 18"></path>
                        <path d="m6 6 12 12"></path>
                      </svg>
                    </button>
                  </div>
                  <div class="modal-content text-left p-4 h-full">
                    <div class="flex justify-center">
                      <img
                        id="uploaded-image"
                        class="rounded-xl"
                        alt="uploaded Image"
                        style="height: 400px"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div id="resolved" class="container mx-auto p-4">
              <div id="ticket-container" class="md:flex md:gap-8">
                <div class=" md:bg-white md:py-5 w-full md:w-[90%]">
                  <div id="ticket-list" class="w-full min-h-screen">
                    <!-- Tickets will be dynamically generated here -->
                  </div>
                </div>
                <div class="md:block hidden w-[40%]">
                  <div
                    class="bg-white border-gray rounded-md p-6 shadow-md h-fit w-full"
                  >
                    <div class="text-lg font-sans my-1">FAQ</div>
                    <div class="flex justify-between">
                      <div class="text-sm font-sans my-0.5">Account Details</div>
                      <div class="mx-1 mt-1">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 24 24"
                          fill="gray"
                          class="w-4 h-4"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                    </div>
                    <!-- Additional FAQ items can be added here -->
                  </div>
                </div>
              </div>

              <div id="no-tickets" class="flex justify-center items-center hidden">
                <div>
                  <img src="images/no-data-found.jpeg" alt="" class="p-20">
                  <p class="text-center py-3 text-gray-600 min-h-screen">No tickets available</p>
                </div>
              </div>

              <!-- Modal for ticket details -->
              <div
                id="ticket-modal"
                class="fixed inset-0 z-50 hidden overflow-hidden flex justify-center items-center min-h-screen"
                style="background: rgba(113, 110, 110, 0.7)"
              >
                <div
                  class="border shadow-lg modal-container bg-white w-full h-full shadow-lg z-50 overflow-y-auto"
                >
                  <div class="modal-content text-left h-full">
                    <div class="bg-[#eeeff4] md:bg-white md:py-4 md:mt-[5%]">
                      <div
                        class="flex justify-between w-full items-center container md:w-[90%] mx-auto"
 
                      >
                        <div class="p-3 md:py-6 md:text-[30px]">
                          Hi <span id="username"></span>,<br />
                          We are here to help you
                        </div>
                        <div class="md:block hidden pl-6">
                          <button
                            id="create-ticket"
                            class="block py-2 px-3 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-lg bg-blue-600 text-white hover:bg-[#2741b6] disabled:opacity-50 disabled:pointer-events-none"
                          >
                            Create Ticket
                          </button>
                        </div>
                      </div>
                    </div>
                    <div
                      class="flex flex-col bg-[#eeeff4] md:bg-white pointer-events-auto max-w-full max-h-full h-full"
                    >
                      <div class="container md:mx-auto md:w-[90%]">
                        <div
                          class="flex justify-between items-center py-3 px-2"
                        >
                          <div class="flex items-center">
                            <div id="back-button" class="cursor-pointer">
                              <svg
                                xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 20 20"
                                fill="currentColor"
                                class="w-7 h-7"
                              >
                                <path
                                  fill-rule="evenodd"
                                  d="M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z"
                                  clip-rule="evenodd"
                                />
                              </svg>
                            </div>
                            <div class="text-xs font-semibold" id="ticket-number">
                              #12345
                            </div>
                          </div>
                          <div class="md:px-6">
                            <div
                              class="uppercase bg-green-200 text-green-700 text-xs px-4 py-2 flex items-center justify-center"
                              id="ticket-status"
                            >
                              Open
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="md:pb-5 pb-20 bg-[#F9FAFF] ">
                        <div class="w-full p-4 bg-[#eeeff4] md:bg-white">
                          <div id="ticket-details" class="flex flex-col">
                            <!-- Ticket details will be dynamically generated here -->
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
              <script>
                           function closeTicketModal() {
    document.getElementById("ticket-modal").classList.add("hidden");
}
                document.addEventListener("DOMContentLoaded", () => {
       
                  const params = new URLSearchParams(window.location.search);
                  const clientname = params.get("clientname");
                  const clientemail = params.get("clientemail");
                  const clientcode = params.get("clientcode");

                  const decodedClientName = clientname ? atob(clientname) : "User    ";
                  localStorage.setItem("clientname", decodedClientName);
                  localStorage.setItem("clientemail", clientemail);
                  localStorage.setItem("clientcode", clientcode);

                  const username = localStorage.getItem("clientname");
                  document.getElementById("username").textContent =
                    username || "User     ";

                  let openTicketsCount = [];
                  let resolvedTickets = [];
                  let setTab = 1;

                  fetchTickets();
                  document.getElementById("loading").classList.remove("hidden");

  // Simulate loading for 2 seconds
  setTimeout(() => {
    // Hide loading state and show ticket content
    document.getElementById("loading").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
    
  
  }, 2000);

                  function fetchTickets() {
                    const emailId = localStorage.getItem("clientemail");
                    const formData = new FormData();
                    formData.append("emailId", emailId);

                    axios
                      .post(
                        "https://g1.gwcindia.in/ticket-api/get-user-all-tickets.php",
                        formData
                      )
                      .then((response) => {
                        openTicketsCount = response.data.data.filter(
                          (item) =>
                            item.status.name === "Open" ||
                            item.status.name === "In-Progress"
                        );
                        resolvedTickets = response.data.data.filter(
                          (item) =>
                            item.status.name === "Closed" ||
                            item.status.name === "Awaiting Reply"
                        );
                        updateTicketCounts();
                      })
                      .catch((error) => {
                        console.error(error.message || "An error occurred");
                      });
                  }

                  function updateTicketCounts() {
                    document.getElementById("open-tickets-count").textContent =
                      openTicketsCount.length;
                    document.getElementById("resolved-tickets-count").textContent =
                      resolvedTickets.length;
                    if (openTicketsCount.length > 0) {
                      document
                        .getElementById("create-ticket-button")
                        .classList.remove("hidden");
                      document
                        .getElementById("fixed-create-ticket-button")
                        .classList.remove("hidden");
                    }
                  }

                  window.getTabId = function (id) {
                    const openTab = document.getElementById("open-tickets-tab");
                    const resolvedTab = document.getElementById("resolved-tickets-tab");
                    const ticketContent = document.getElementById("ticket-content");

                    openTab.classList.remove("active-tab");
                    resolvedTab.classList.remove("active-tab");

                    if (id === 1) {
                      openTab.classList.add("active-tab");
                      fetchTicketContent("open");
                    } else if (id === 2) {
                      resolvedTab.classList.add("active-tab");
                      fetchTicketContent("resolved");
                    }
                  };

                  function fetchTicketContent(tab) {
    const emailId = localStorage.getItem("clientemail");
    const formData = new FormData();
    formData.append("emailId", emailId);

    axios.post("https://g1.gwcindia.in/ticket-api/get-user-all-tickets.php", formData)
        .then((response) => {
            openTicketsCount = response.data.data.filter(
                (item) => item.status.name === "Open" || item.status.name === "In-Progress"
            );
            resolvedTickets = response.data.data.filter((item) => item.status.name === "Closed" || item.status.name === "Awaiting Reply" );
            const tickets = tab === "open" ? openTicketsCount : resolvedTickets;
            updateTicketList(tickets);
        })
        .catch((error) => {
            console.error(error.message || "An error occurred");
        });
}

function updateTicketList(tickets) {
    const ticketList = document.getElementById("ticket-list");
    ticketList.innerHTML = ""; // Clear existing tickets

    // Check if there are any tickets to display
    if (tickets.length === 0) {
        document.getElementById("no-tickets").classList.remove("hidden");
    } else {
        document.getElementById("no-tickets").classList.add("hidden");

        // Iterate over the tickets and create DOM elements for each
        tickets.forEach((ticket) => {
            const ticketDiv = document.createElement("div");
            ticketDiv.className = "flex flex-col bg-white shadow-xl rounded-xl p-4 md:p-5 mb-4";

            // Set the onclick event handler to open the ticket modal
            ticketDiv.onclick = () => openTicketModal(ticket);

            // Populate the ticketDiv with ticket details
            ticketDiv.innerHTML = `
            <div class="flex justify-between">
    <div class="text-xs font-semibold">#${ticket.number}</div>
    <div class="flex gap-1">
        <div class="px-4 uppercase text-xs text-center bg-yellow-200 flex items-center">
            ${ticket.status.name}
           
        </div>
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="green" class="h-6 w-6">
  <path fillRule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z" clipRule="evenodd" />
</svg>

    </div>
</div>
<div class="text-base font-bold">${ticket.subject}</div>
<div class="text-xs">${formatDate(ticket.created_at)}</div>
<div class="bg-gray-100 rounded-md p-2 mt-5 mb-2">test</div>
            `;

            // Append the ticketDiv to the ticketList
            ticketList.appendChild(ticketDiv);
        });
    }
}

                  // Function to open ticket modal
                  function openTicketModal(ticket) {
                    debugger
                    console.log("openn")
    document.getElementById("ticket-number").textContent = `#${ticket.number}`;
    document.getElementById("ticket-status").textContent = ticket.status.name;
    getTicketMessages(ticket.number);
    document.getElementById("ticket-details").innerHTML = `
    <div
      class="my-4 rounded-lg mx-2"
      style="
        
        padding: 3px;
        background-color:  #ecebeb;
      "
      >
      <div class="flex">   <div
      class="my-2 rounded-full mx-2"
      style="
        width: 50px;
        height: 50px;
      
        background-color:  #e2e2e2;
      "
      ></div>   <div
      class="mt-5 rounded-lg mx-2"
      style="
      width: 200px;
      height: 20px;
      
      background-color:  #e2e2e2;
      "
      ></div></div>
      <div
      class="my-2 rounded-lg mx-2"
      style="
      width: 200px;
      height: 20px;
      
      background-color:  #e2e2e2;
      "
      ></div>
      <div
      class="my-2 rounded-lg mx-2"
      style="
      width: 200px;
      height: 20px;
      
      background-color:  #e2e2e2;
      "
      ></div>   
      </div>
      <div
      class="my-4 rounded-lg mx-2"
      style="
        
        padding: 3px;
        background-color:  #ecebeb;
      "
      >
      <div class="flex">   <div
      class="my-2 rounded-full mx-2"
      style="
        width: 50px;
        height: 50px;
      
        background-color:  #e2e2e2;
      "
      ></div>   <div
      class="mt-5 rounded-lg mx-2"
      style="
      width: 200px;
      height: 20px;
      
      background-color:  #e2e2e2;
      "
      ></div></div>
      <div
      class="my-2 rounded-lg mx-2"
      style="
      width: 200px;
      height: 20px;
      
      background-color:  #e2e2e2;
      "
      ></div>
      <div
      class="my-2 rounded-lg mx-2"
      style="
      width: 200px;
      height: 20px;
      
      background-color:  #e2e2e2;
      "
      ></div>   
      </div>
      <div
      class="my-4 rounded-lg mx-2"
      style="
        
        padding: 3px;
        background-color:  #ecebeb;
      "
      >
      <div class="flex">   <div
      class="my-2 rounded-full mx-2"
      style="
        width: 50px;
        height: 50px;
      
        background-color:  #e2e2e2;
      "
      ></div>   <div
      class="mt-5 rounded-lg mx-2"
      style="
      width: 200px;
      height: 20px;
      
      background-color:  #e2e2e2;
      "
      ></div></div>
      <div
      class="my-2 rounded-lg mx-2"
      style="
      width: 200px;
      height: 20px;
      
      background-color:  #e2e2e2;
      "
      ></div>
      <div
      class="my-2 rounded-lg mx-2"
      style="
      width: 200px;
      height: 20px;
      
      background-color:  #e2e2e2;
      "
      ></div>   
      </div>
    `;
    document.getElementById("ticket-modal").classList.remove("hidden");

    // Fetch ticket messages and details
    getTicketMessages(ticket.number);
    document.getElementById("ticket-modal").classList.remove("hidden");
}

// Function to fetch ticket messages
async function getTicketMessages(number) {
  debugger
    const formData = new FormData();
    formData.append("ticket_no", number);
    const clientCode = localStorage.getItem("clientcode");
    formData.append("clientcode", clientCode);
    try {
        const response = await axios.post("https://g1.gwcindia.in/ticket-api/get-ticket-status-messages.php", formData);
        const messages = response.data.data;
        const ticketDetails = document.getElementById("ticket-details");

        // Clear previous content
        ticketDetails.innerHTML = '';

        // Check if there are messages
        if (messages.length > 0) {
            // Loop through messages and create HTML content
            messages.forEach((msg, index) => {
                const messageHTML = `
                    <div class="space-y-4 my-2">
                        <div class="bg-blue-100 p-4 rounded-lg flex">
                            <div class="flex-shrink-0">
                                <div class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center">
                                    E
                                </div>
                            </div>
                            <div class="ml-4">
                                <p class="text-gray-700">${msg.excerpt}</p>
                                <p class="text-gray-500">${msg.text}</p>
                                <p class="text-gray-400 text-sm mt-2">${new Date(msg.created_at * 1000).toLocaleString()}</p>
                            </div>
                        </div>
                    </div>
                `;
                ticketDetails.innerHTML += messageHTML;

               
                if (index === 0) {
                    ticketDetails.innerHTML += `
                        <div class="bg-gray-100 p-4 my-4 rounded-lg flex">
                            <div class="flex-shrink-0">
                                <img alt="Support team logo" class="rounded-full w-8 h-8" height="40" src="images/goodwill.jpeg" width="40"/>
                            </div>
                            <div class="ml-4">
                                <p class="text-gray-700">
                                    Your ticket has been created successfully. Our support team will get back to you in 24-48 business hours.
                                </p>
                                <p class="text-gray-400 text-sm mt-2">
                                    ${new Date().toLocaleString()}  <!-- Current date and time -->
                                </p>
                            </div>
                        </div>
                    `;
                }
            });
        }

        // Additional UI elements for closed tickets
        ticketDetails.innerHTML += `
            <div class="bg-white rounded-lg">
                <div class="flex space-x-2 mb-2">
                    <button class="text-gray-500"><i class="fas fa-bold"></i></button>
                    <button class="text-gray-500"><i class="fas fa-italic"></i></button>
                    <button class="text-gray-500"><i class="fas fa-underline"></i></button>
                    <button class="text-gray-500"><i class="fas fa-paperclip"></i></button>
                    <button class="text-gray-500"><i class="fas fa-list-ul"></i></button>
                    <button class="text-gray-500"><i class="fas fa-list-ol"></i></button>
                    <button class="text-gray-500"><i class="fas fa-align-left"></i></button>
                    <button class="text-gray-500"><i class="fas fa-align-center"></i></button>
                    <button class="text-gray-500"><i class="fas fa-align-right"></i></button>
                </div>
                <textarea class="w-full border border-gray-300 rounded-lg p-2" placeholder="Description (min 30 characters)..." rows="3"></textarea>
            </div>
            <div class="pr-10 py-5 border-t border-gray-200 fixed bottom-0 w-full">
    <button class="w-full button text-white py-2 block rounded-lg" onclick="document.getElementById('ticket-modal').classList.add('hidden');">
        Submit
    </button>
</div>
        `;
    } catch (error) {
        console.error("Error fetching ticket status messages:", error);
    }
}
                  
        

                  // Function to format date
                  function formatDate(timestamp) {
                    const date = new Date(timestamp * 1000);
                    return `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
                  }
                });
              </script>
            </div>  <div class="fixed-bottom p-3 md:hidden" id="fixed-create-ticket-button">
              <button type="button" class="button w-full" onclick="openCreate()">
                Create Ticket
              </button>
            </div>
          </div>
        </div>
      
      </div>
    </div>

    <!-- Create Ticket Modal -->
    <div id="create-ticket-modal" class="fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center hidden">
      <div class="bg-white rounded-lg p-6 w-11/12 md:w-1/3">
        <div class="modal-content text-left h-full">
          <div class="grid grid-cols-6 items-center p-3">
            <div class="flex justify-center col-span-5">
              <h3 class="font-bold text-gray-800">Raise a Ticket</h3>
            </div>
            <div class="col-span-1 flex justify-end">
              <button
                type="button class="flex justify-center items-center size-7 text-sm font-semibold rounded-full text-gray-800 hover:bg-gray-100 disabled:opacity-50 disabled:pointer-events-none"
                onclick="closeModal()"
              >
                <span class="sr-only">Close</span>
                <svg
                  class="flex-shrink-0 size-4"
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M18 6 6 18"></path>
                  <path d="m6 6 12 12"></path>
                </svg>
              </button>
            </div>
          </div>
          <div class="p-4 overflow-y-auto">
            <div class="space-y-4">
              <div class="w-full">
                <button
                  id="categoryButton"
                  type="button"
                  class="w-full py-3 px-4 inline-flex justify-between items-center gap-x-2 text-sm rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50"
                  onclick="toggleCategoryDropdown()"
                >
                  <p id="selectedCategoryText">Select category</p>
                  <svg
                    class="hs-dropdown-open:rotate-180 size-4"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="m6 9 6 6 6-6" />
                  </svg>
                </button>
                <div id="categoryDropdown" class="hidden relative">
                  <div
                    class="rounded-lg border absolute bg-gray-50 shadow-md z-50 w-full max-h-40 overflow-y-auto"
                  >
                    <div id="categoryList"></div>
                  </div>
                </div>
              </div>
              <div class="w-full">
                <button
                  id="subcategoryButton"
                  type="button"
                  class="w-full py-3 px-4 inline-flex justify-between items-center gap-x-2 text-sm rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50"
                  onclick="toggleSubcategoryDropdown()"
                >
                  <p id="selectedSubCategoryText">Select subcategory</p>
                  <svg
                    class="hs-dropdown-open:rotate-180 size-4"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="m6 9 6 6 6-6" />
                  </svg>
                </button>
                <div id="subcategoryDropdown" class="hidden relative">
                  <div
                    class="rounded-lg border absolute bg-gray-50 shadow-md z-50 w-full max-h-40 overflow-y-auto"
                  >
                    <div id="subcategoryList"></div>
                  </div>
                </div>
              </div>
              <input
                id="subjectInput"
                type="text"
                class="py-3 shadow-sm px-4 block w-full border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500"
                placeholder="Subject"
              />
              <textarea
                id="descriptionInput"
                class="py-3 shadow-sm px-4 block w-full border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500"
                placeholder="Description"
              ></textarea>
              <div class="flex items-center justify-center w-full">
                <label>
                  <div
                    class="flex gap-1 flex-row items-center justify-center cursor-pointer"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 20 20"
                      fill="blue"
                      class="w-5 h-5"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M15.621 4.379a3 3 0 0 0-4.242 0l-7 7a3 3 0 0 0 0 4.241 4.243h.001l.497-.5a.75.75 0 0 1 1.064 1.057l-.498.501.002.002a4.5 4.5 0 0 1-6.364-6.364l7-7a4.5 4.5 0 0 1 6.368 6.36l-3.455 3.553A2.625 2.625 0 1 1 9.52 9.52l3.45-3.451a.75.75 0 1 1 1.061 1.06l-3.45 3.451a1.125 1.125 0 0 0 1.587 1.595l3.454-3.553a3 3 0 0 0 0-4.242Z"
                        clip-rule="evenodd"
                      />
                    </svg>
                    <div
                      class="text-xs text-[#2741b6] flex items-center justify-center"
                    >
                      Attach Image or Pdf ( Max Size 5mb )
                    </div>
                  </div>
                  <input
                    id="fileInput"
                    type="file"
                    class="hidden"
                    accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
                    onchange="uploadImage(event)"
                  />
                </label>
              </div>
              <div class="flex justify-end items-center gap-x-2 p-3">
                <button
                  id="createTicketButton"
                  type="button"
                  class="w-full py-3 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-lg bg-blue-700 text-white hover:bg-[#2741b6]"
                  onclick="createTicket()"
                >
                  Create Ticket
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Response Modal -->
<div id="responseModal" class="fixed inset-0 z-50 hidden overflow-hidden flex justify-center items-center" style="background: rgba(0, 0, 0, 0.7)">
  <div class="border shadow-lg modal-container bg-white w-11/12 mx-auto rounded-xl shadow-lg z-50 overflow-y-auto">
      <div class="modal-content py-4 text-left px-6 h-full">
          <div id="responseContent" class="flex justify-center py-3">
              <!-- Response message will be displayed here -->
          </div>
          <div class="flex justify-center items-center gap-x-2 py-3 px-4">
              <button type="button" class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700" onclick="closeResponseModal()">
                  Close
              </button>
          </div>
      </div>
  </div>
</div>
<div  id="ratingModal"  class="fixed inset-0 z-50 hidden overflow-hidden flex justify-center items-center" style="background: rgba(0, 0, 0, 0.7)">
  <div class="border shadow-lg modal-container bg-white w-11/12 mx-auto rounded-xl shadow-lg z-50 overflow-y-auto">
    <div class="modal-content py-4 text-left px-6 h-full">
      <div class="close-button flex justify-end" onclick="document.getElementById('ratingModal').style.display='none'">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-6 w-6">
          <path fillRule="evenodd" d="M5.47 5.47a.75.75 0 0 1 1.06 0L12 10.94l5.47-5.47a.75.75 0 1 1 1.06 1.06L13.06 12l5.47 5.47a.75.75 0 1 1-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 0 1-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 0 1 0-1.06Z" clipRule="evenodd" />
        </svg>
        
      </div>
      <div class="text-center" style="line-height: 2">
        <div id="ratingMessage">
          Please take a moment to rate your experience with our app.
        </div>
        <div id="selectedRating" class="text-sm" style="display: none;">
          You selected <span id="ratingValue">0</span> stars out of 5
        </div>
      </div>
      <div class="flex items-center justify-center py-3">
        <div class="inline-flex items-center justify-center">
          <span id="starRating ">
         
            
            <div id="starRating" class="flex">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="orange" class="star h-6 w-6" onclick="selectRating(1)">
                  <path fillRule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z" clipRule="evenodd" />
              </svg>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="orange" class="star h-6 w-6" onclick="selectRating(2)">
                  <path fillRule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z" clipRule="evenodd" />
              </svg>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="orange" class="star h-6 w-6" onclick="selectRating(3)">
                  <path fillRule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z" clipRule="evenodd" />
              </svg>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="orange" class="star h-6 w-6" onclick="selectRating(4)">
                <path fillRule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z" clipRule="evenodd" />
            </svg>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="orange" class="star h-6 w-6" onclick="selectRating(5)">
                  <path fillRule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z" clipRule="evenodd" />
              </svg>
          </div>                                                        
          </span>
        </div>
      </div>
      <div class="w-full flex justify-center py-2">
       
        <div class=" py-5 border-t border-gray-200 ">
          <button class="w-full button text-white py-2 px-10 block rounded-lg" onclick="submitRating()"  id="submitRatingButton">Rate us</button>
      </div>
      </div>
    </div>
  </div>
</div>


    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>    let allCategories = [];
    let categoryIndex= 0;
        let subcategories = [];
        let selectedCategory = null;
        let selectedSubCategory = null;
        let attachment = null;
        let selectedFileName = null;
       
        let currentRating = 0;

function selectRating(rating) {
    currentRating = rating;
    const stars = document.querySelectorAll('.star');

    stars.forEach((star, index) => {
        if (index < rating) {
            star.setAttribute('fill', 'orange'); // Change fill color for selected stars
            star.setAttribute('stroke', 'orange'); // Change stroke color for selected stars
        } else {
            star.setAttribute('fill', 'none'); // Reset fill color for unselected stars
            star.setAttribute('stroke', 'orange'); // Keep stroke color for unselected stars
        }
    });
}
function submitRating() {
    if (selectedRating === 0) {
        alert("Please select a rating before submitting.");
        return;
    }
    // Here you can handle the submission of the rating, e.g., send it to your server
    console.log(`Rating submitted: ${selectedRating} stars`);
    document.getElementById('ratingModal').style.display = 'none'; // Close the modal after submission
}
             function openCreate() {
    document.getElementById("create-ticket-modal").classList.remove("hidden");
  }
 // Call this to fetch and display open tickets
  function toggleCategoryDropdown() {
            const dropdown = document.getElementById('categoryDropdown');
            dropdown.classList.toggle('hidden');
        }

        function toggleSubcategoryDropdown() {
            const dropdown = document.getElementById('subcategoryDropdown');
            dropdown.classList.toggle('hidden');
        }

        function selectCategory(category) {
          debugger
            selectedCategory = category;
            document.getElementById('selectedCategoryText').innerText = category;
           
 categoryIndex = allCategories.findIndex(category => category === selectedCategory);
            document.getElementById('categoryDropdown').classList.add('hidden');
            getSubcategories(category);
        }

        function selectSubCategory(subCategory) {
            selectedSubCategory = subCategory;
            document.getElementById('selectedSubCategoryText').innerText = subCategory;
            document.getElementById('subcategoryDropdown').classList.add('hidden');
        }

        async function getDepartmentData() {
            try {
                const response = await axios.get('https://g1.gwcindia.in/ticket-api/ticket-category-subcategory.php');
                allCategories = response.data.map(item => Object.keys(item)[0]);
                populateCategoryDropdown();
            } catch (error) {
                console.error('Error fetching departments:', error);
            }
        }

        function populateCategoryDropdown() {
            const categoryList = document.getElementById('categoryList');
            categoryList.innerHTML = '';
            allCategories.forEach(category => {
                const div = document.createElement('div');
                div.innerText = category;
                div.className = 'cursor-pointer text-sm text-gray-800 hover:bg-gray-100 p-2';
                div.onclick = () => selectCategory(category);
                categoryList.appendChild(div);
            });
        }

        async function getSubcategories(category) {
          debugger
            try {
              const response = await axios.get(`https://g1.gwcindia.in/ticket-api/ticket-category-subcategory.php?category=${category}`);
              subcategories = response.data.find(item => item[category])?.[category] || [];
                populateSubcategoryDropdown();
            } catch (error) {
                console.error('Error fetching subcategories:', error);
            }
        }
        function openRatingModal() {
    console.log("Rating modal opened"); // Debugging line
    document.getElementById('ratingModal').style.display = 'flex'; // Show the rating modal
}       
       

        function populateSubcategoryDropdown() {
          debugger
            const subcategoryList = document.getElementById('subcategoryList');
            subcategoryList.innerHTML = '';
            subcategories.forEach(sub => {
                const div = document.createElement('div');
                div.innerText = sub;
                div.className = 'cursor-pointer text-sm text-gray-800 hover:bg-gray-100 p-2';
                div.onclick = () => selectSubCategory(sub);
                subcategoryList.appendChild(div);
            });
        }

        function uploadImage(event) {
            const file = event.target.files[0];
            if (file) {
                selectedFileName = file.name;
                const reader = new FileReader();
                reader.onload = () => {
                    attachment = reader.result.split(',')[1]; // Get the base64 string
                };
                reader.readAsDataURL(file);
            }
        }

        async function createTicket() {
    const subject = document.getElementById('subjectInput').value;
    const description = document.getElementById('descriptionInput').value;

    if (!selectedCategory || !selectedSubCategory || !subject || !description) {
        alert('Please fill in all fields.');
        return;
    }

    const formData = new FormData();
    formData.append('department', categoryIndex);
    formData.append('subject', subject);
    formData.append('text', description);
    formData.append('subCat', selectedSubCategory);
    const clientCode = localStorage.getItem("clientcode");
    formData.append("clientcode", clientCode);
    if (attachment) {
        formData.append('attachment', attachment);
        formData.append('filename', selectedFileName);
    }

    try {
        const response = await axios.post('https://g1.gwcindia.in/ticket-api/create-ticket.php', formData);
        
        // Show success message
        showResponseModal(response.data);
        
        // Close the modal after a short delay
        setTimeout(() => {
           
            document.getElementById('create-ticket-modal').classList.add('hidden'); // Hide the modal
        }, 2000); // Adjust the delay as needed (2000 ms = 2 seconds)
    } catch (error) {
        console.error('Error creating ticket:', error);
        showResponseModal({ status: 'error', message: 'Failed to create ticket.' });
    }
}

function showResponseModal(data) {
    const responseModal = document.getElementById('responseModal');
    const responseContent = document.getElementById('responseContent');

    // Check if the responseContent element exists
    if (!responseContent) {
        console.error('Response content element not found!');
        return; // Exit the function if the element is not found
    }

    responseContent.innerHTML = '';

    if (data.status === 'ok') {
        responseContent.innerHTML = `<div class="text-green-500">Ticket created successfully! Ticket No: #${data.data.ticket_no}</div>`;
    } else {
        responseContent.innerHTML = `<div class="text-red-500">${data.message}</div>`;
    }

    responseModal.classList.remove('hidden');

    // Close the modal after a short delay
    setTimeout(() => {
        closeModal(); // Close the create ticket modal
        closeResponseModal(); // Close the response modal
    }, 2000); // Adjust the delay as needed (2000 ms = 2 seconds)
}

function closeResponseModal() {
    const responseModal = document.getElementById('responseModal');
    if (responseModal) {
        responseModal.classList.add('hidden');
    }
}

function closeModal() {
    document.getElementById('create-ticket-modal').classList.add('hidden');
}

        function showResponseModal(data) {
            const responseModal = document.getElementById('responseModal');
            const responseContent = document.getElementById('responseContent');
            responseContent.innerHTML = '';

            if (data.status === 'ok') {
                responseContent.innerHTML = `<div class="text-green-500">Ticket created successfully! Ticket No: #${data.data.ticket_no}</div>`;
            } else {
                responseContent.innerHTML = `<div class="text-red-500">${data.message}</div>`;
            }

            responseModal.classList.remove('hidden');
        }

       

        function closeResponseModal() {
            document.getElementById('responseModal').classList.add('hidden');
        }
      document.addEventListener("DOMContentLoaded", () => {
        getDepartmentData();
      
        const params = new URLSearchParams(window.location.search);
        const clientname = params.get("clientname");
        const clientemail = params.get("clientemail");
        const clientcode = params.get("clientcode");

        const decodedClientName = clientname ? atob(clientname) : "User     ";
        localStorage.setItem("clientname", decodedClientName);
        localStorage.setItem("clientemail", clientemail);
        localStorage.setItem("clientcode", clientcode);

        const username = localStorage.getItem("clientname");
        document.getElementById("username").textContent =
          username || "User      ";

        let openTicketsCount = [];
        let resolvedTickets = [];
        let setTab = 1;

        fetchTickets();

        function fetchTickets() {
          const emailId = localStorage.getItem("clientemail");
          const formData = new FormData();
          formData.append("emailId", emailId);

          axios
            .post(
              "https://g1.gwcindia.in/ticket-api/get-user-all-tickets.php",
              formData
            )
            .then((response) => {
              openTicketsCount = response.data.data.filter(
                (item) =>
                  item.status.name === "Open" ||
                  item.status.name === "In-Progress"
              );
              resolvedTickets = response.data.data.filter(
                (item) =>
                  item.status.name === "Closed" ||
                  item.status.name === "Awaiting Reply"
              );
              updateTicketCounts();
            })
            .catch((error) => {
              console.error(error.message || "An error occurred");
            });
        }

        function updateTicketCounts() {
          document.getElementById("open-tickets-count").textContent =
            openTicketsCount.length;
          document.getElementById("resolved-tickets-count").textContent =
            resolvedTickets.length;
          if (openTicketsCount.length > 0) {
            document
              .getElementById("create-ticket-button")
              .classList.remove("hidden");
            document
              .getElementById("fixed-create-ticket-button")
              .classList.remove("hidden");
          }
        }
        getTabId(1)
        fetchTicketContent("open"); 
        window.getTabId = function (id) {
    const openTab = document.getElementById("open-tickets-tab");
    const resolvedTab = document.getElementById("resolved-tickets-tab");
    const ticketContent = document.getElementById("ticket-content");

    openTab.classList.remove("active-tab");
    resolvedTab.classList.remove("active-tab");

    if (id === 1) {
        openTab.classList.add("active-tab");
        fetchTicketContent("open");
    } else if (id === 2) {
        resolvedTab.classList.add("active-tab");
        fetchTicketContent("resolved");
    }
};

function fetchTicketContent(tab) {
    const ticketContent = document.getElementById("ticket-content");
    ticketContent.classList.remove("hidden");

    const tickets = tab === "open" ? openTicketsCount : resolvedTickets;
    updateTicketList(tickets);
}

function updateTicketList(tickets) {
    const ticketList = document.getElementById("ticket-list");
    ticketList.innerHTML = ""; // Clear existing tickets

    if (tickets.length === 0) {
        document.getElementById("no-tickets").classList.remove("hidden");
    } else {
        document.getElementById("no-tickets").classList.add("hidden");
        tickets.forEach((ticket) => {
            const ticketDiv = document.createElement("div");
            ticketDiv.className = "flex flex-col bg-white shadow-xl rounded-xl p-4 md:p-5 mb-4";

            // Set the onclick event handler
            ticketDiv.onclick = () => openTicketModal(ticket);

            ticketDiv.innerHTML = `
                <div class="flex justify-between">
                    <div class="text-xs font-semibold">#${ticket.number}</div>
                    <div class="flex gap-1">
                        <div class="px-4 uppercase text-xs text-center bg-yellow-200 flex items-center">
                            ${ticket.status.name}
                        </div>
                         <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="green" class="h-6 w-6">
  <path fillRule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z" clipRule="evenodd" />
</svg>
                    </div>
                </div>
                <div class="text-base font-bold">${ticket.subject}</div>
                <div class="text-xs">${formatDate(ticket.created_at)}</div>
                <div class="bg-gray-100 rounded-md p-2 mt-5 mb-2">test</div>
            `;

            ticketList.appendChild(ticketDiv);
        });
    }
}
        // Function to open ticket modal
        function openTicketModal(ticket) {
                    debugger
                    console.log("re3solved")
    document.getElementById("ticket-number").textContent = `#${ticket.number}`;
    document.getElementById("ticket-status").textContent = ticket.status.name;
    getTicketMessages(ticket.number);
    document.getElementById("ticket-details").innerHTML = `
        <div
      class="my-4 rounded-lg mx-2"
      style="
        
        padding: 3px;
        background-color:  #ecebeb;
      "
      >
      <div class="flex">   <div
      class="my-2 rounded-full mx-2"
      style="
        width: 50px;
        height: 50px;
      
        background-color:  #e2e2e2;
      "
      ></div>   <div
      class="mt-5 rounded-lg mx-2"
      style="
      width: 200px;
      height: 20px;
      
      background-color:  #e2e2e2;
      "
      ></div></div>
      <div
      class="my-2 rounded-lg mx-2"
      style="
      width: 200px;
      height: 20px;
      
      background-color:  #e2e2e2;
      "
      ></div>
      <div
      class="my-2 rounded-lg mx-2"
      style="
      width: 200px;
      height: 20px;
      
      background-color:  #e2e2e2;
      "
      ></div>   
      </div>
      <div
      class="my-4 rounded-lg mx-2"
      style="
        
        padding: 3px;
        background-color:  #ecebeb;
      "
      >
      <div class="flex">   <div
      class="my-2 rounded-full mx-2"
      style="
        width: 50px;
        height: 50px;
      
        background-color:  #e2e2e2;
      "
      ></div>   <div
      class="mt-5 rounded-lg mx-2"
      style="
      width: 200px;
      height: 20px;
      
      background-color:  #e2e2e2;
      "
      ></div></div>
      <div
      class="my-2 rounded-lg mx-2"
      style="
      width: 200px;
      height: 20px;
      
      background-color:  #e2e2e2;
      "
      ></div>
      <div
      class="my-2 rounded-lg mx-2"
      style="
      width: 200px;
      height: 20px;
      
      background-color:  #e2e2e2;
      "
      ></div>   
      </div>
      <div
      class="my-4 rounded-lg mx-2"
      style="
        
        padding: 3px;
        background-color:  #ecebeb;
      "
      >
      <div class="flex">   <div
      class="my-2 rounded-full mx-2"
      style="
        width: 50px;
        height: 50px;
      
        background-color:  #e2e2e2;
      "
      ></div>   <div
      class="mt-5 rounded-lg mx-2"
      style="
      width: 200px;
      height: 20px;
      
      background-color:  #e2e2e2;
      "
      ></div></div>
      <div
      class="my-2 rounded-lg mx-2"
      style="
      width: 200px;
      height: 20px;
      
      background-color:  #e2e2e2;
      "
      ></div>
      <div
      class="my-2 rounded-lg mx-2"
      style="
      width: 200px;
      height: 20px;
      
      background-color:  #e2e2e2;
      "
      ></div>   
      </div>
    `;
    document.getElementById("ticket-modal").classList.remove("hidden");

    // Fetch ticket messages and details
    getTicketMessages(ticket.number);
    document.getElementById("ticket-modal").classList.remove("hidden");
}

async function getTicketMessages(number) {
  debugger
    const formData = new FormData();
    formData.append("ticket_no", number);
    const clientCode = localStorage.getItem("clientcode");
    formData.append("clientcode", clientCode);
    try {
        const response = await axios.post("https://g1.gwcindia.in/ticket-api/get-ticket-status-messages.php", formData);
        const messages = response.data.data;
        const ticketDetails = document.getElementById("ticket-details");

        // Clear previous content
        ticketDetails.innerHTML = '';

        // Check if there are messages
        if (messages.length > 0) {
            // Loop through messages and create HTML content
            messages.forEach((msg, index) => {
                const messageHTML = `
                    <div class="space-y-4 my-2">
                        <div class="bg-blue-100 p-4 rounded-lg flex">
                            <div class="flex-shrink-0">
                                <div class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center">
                                    E
                                </div>
                            </div>
                            <div class="ml-4">
                                <p class="text-gray-700">${msg.excerpt}</p>
                                <p class="text-gray-500">${msg.text}</p>
                                <p class="text-gray-400 text-sm mt-2">${new Date(msg.created_at * 1000).toLocaleString()}</p>
                            </div>
                        </div>
                    </div>
                `;
                ticketDetails.innerHTML += messageHTML;

               
                if (index === 0) {
                    ticketDetails.innerHTML += `
                        <div class="bg-gray-100 p-4 my-4 rounded-lg flex">
                            <div class="flex-shrink-0">
                                <img alt="Support team logo" class="rounded-full w-8 h-8" height="40" src="images/goodwill.jpeg" width="40"/>
                            </div>
                            <div class="ml-4">
                                <p class="text-gray-700">
                                    Your ticket has been created successfully. Our support team will get back to you in 24-48 business hours.
                                </p>
                                <p class="text-gray-400 text-sm mt-2">
                                    ${new Date().toLocaleString()}  <!-- Current date and time -->
                                </p>
                            </div>
                        </div>
                    `;
                }
            });
        }

        ticketDetails.innerHTML += `
    <div class="pr-10 py-5 border-t border-gray-200 fixed bottom-0 w-full">
        <button class="w-full bg-blue-500 text-white py-2 block rounded-lg button" onclick="openRatingModal()">Ok, Thanks</button>
    </div>
`;
    } catch (error) {
        console.error("Error fetching ticket status messages:", error);
    }
}
 

                  // Function to format date
        function formatDate(timestamp) {
          const date = new Date(timestamp * 1000);
          return `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
        }
  
      });
    </script>
  </body>
</html>